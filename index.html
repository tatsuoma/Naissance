<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Liste de Naissance avec Supabase</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-4">

<div id="auth" class="bg-white p-6 rounded shadow max-w-md w-full mt-20">
  <h2 class="text-xl font-bold mb-4 text-center">Mot de passe</h2>
  <input type="password" id="password" placeholder="Mot de passe" class="border p-2 w-full mb-4 rounded" />
  <button onclick="checkPassword()" class="w-full bg-indigo-600 text-white py-2 rounded">Entrer</button>
  <p id="error" class="text-red-500 mt-2 hidden">Mot de passe incorrect</p>
</div>

<div id="content" class="hidden w-full max-w-4xl">
  <h1 class="text-3xl font-bold text-center my-6">üéÅ Liste de Naissance</h1>
  <div id="article-grid" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
</div>

<div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
  <div class="bg-white p-6 rounded shadow max-w-md w-full">
    <h3 class="text-xl font-semibold mb-4">R√©server <span id="modal-article"></span></h3>
    <form onsubmit="submitReservation(event)">
      <input type="text" id="reserver-name" placeholder="Nom Pr√©nom" required class="border p-2 w-full mb-4 rounded" />
      <input type="hidden" id="current-article" />
      <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded">Confirmer</button>
      <button type="button" onclick="closeModal()" class="mt-2 w-full text-gray-600">Annuler</button>
    </form>
  </div>
</div>

<script>
const SUPABASE_URL = "https://wpewfaibwiigjasocepy.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndwZXdmYWlid2lpZ2phc29jZXB5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAzNzM3NDgsImV4cCI6MjA2NTk0OTc0OH0.guVeW4sz4I8WF0wQTuLYb3CgJvdmUVXqY122HXwWmlE";
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
const PASSWORD = "testmdp2";

const articles = [
  { name: "Chaise haute Sweety Fox", url: "https://www.amazon.fr/dp/B07FDRX1XN" },
  { name: "Langes Orchestra", url: "https://fr.shop-orchestra.com/fr/puericulture/repas/bavoir-et-lange/lange/lot-de-6-langes-en-coton-70-x-70-cm-PBRIA2.html" },
  { name: "Cube en bois Vertbaudet", url: "https://www.vertbaudet.fr/grand-cube-d-activites-en-bois-fsc-tanzanie.htm" },
    { name: "Arche d‚Äô√©veil", url: "https://www.madeinbebe.com/boutique/fr/arche-deveil-promenons-nous-sauthon-baby-deco-385798/a385798" },
    { name: "Bol ventouse Done by Deer", url: "https://donebydeer.com/fr-fr/products/stick-stay-dinner-set-lalee-colour-mix" },
    { name: "Cape de bain Breizh Club", url: "https://www.breizhclub.bzh/accessoires-bebe-et-enfant/1782-cape-de-bain-mariniere-petite-bretonne.html" },
    { name: "Soin Rebozo - Saint-Av√©", url: "https://www.unedoulapourunevie.com/rebozo-vannes-morbihan" },
    { name: "Soin Rebozo - √† domicile", url: "https://www.infinibiennaitre.fr/soin-rebozo-fermeture-postnatal" }
];

let currentReservations = {};

function checkPassword() {
  const val = document.getElementById("password").value;
  if (val === PASSWORD) {
    document.getElementById("auth").classList.add("hidden");
    document.getElementById("content").classList.remove("hidden");
    loadReservations();
  } else {
    document.getElementById("error").classList.remove("hidden");
  }
}

async function loadReservations() {
  const { data, error } = await supabase.from("reservations").select("*");
  if (error) return console.error("Erreur chargement", error);
  currentReservations = {};
  data.forEach(r => currentReservations[r.article] = r.name);
  renderArticles();
}

function renderArticles() {
  const container = document.getElementById("article-grid");
  container.innerHTML = '';
  articles.forEach(article => {
    const reservedBy = currentReservations[article.name];
    const div = document.createElement("div");
    div.className = "bg-white p-4 rounded shadow";
    div.innerHTML = `
      <h2 class="text-lg font-bold">${article.name}</h2>
      <a href="${article.url}" target="_blank" class="text-blue-600 underline text-sm">Voir</a>
      ${reservedBy ? `
        <p class="mt-2 text-gray-700">R√©serv√© par : <strong>${reservedBy}</strong></p>
        <button onclick="cancelReservation('${article.name}', '${reservedBy}')" class="mt-2 bg-red-500 text-white px-4 py-1 rounded">Annuler</button>
      ` : `
        <button onclick="openModal('${article.name}')" class="mt-3 bg-indigo-500 text-white px-4 py-2 rounded">R√©server</button>
      `}
    `;
    container.appendChild(div);
  });
}

function openModal(article) {
  document.getElementById("modal").classList.remove("hidden");
  document.getElementById("modal-article").textContent = article;
  document.getElementById("current-article").value = article;
  document.getElementById("reserver-name").value = '';
}

function closeModal() {
  document.getElementById("modal").classList.add("hidden");
}

async function submitReservation(e) {
  e.preventDefault();
  const name = document.getElementById("reserver-name").value.trim();
  const article = document.getElementById("current-article").value;
  const { error } = await supabase.from("reservations").insert({ name, article });
  if (error) return alert("Erreur r√©servation");
  closeModal();
  loadReservations();
}

async function cancelReservation(article, reservedBy) {
  const input = prompt(`Nom utilis√© pour "${article}" :`);
  if (input === reservedBy) {
    const { error } = await supabase.from("reservations")
      .delete()
      .eq("article", article)
      .eq("name", reservedBy);
    if (error) return alert("Erreur annulation");
    loadReservations();
  } else if (input !== null) {
    alert("Nom incorrect.");
  }
}
</script>

</body>
</html>
